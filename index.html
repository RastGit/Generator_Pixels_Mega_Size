<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Mega Generator — widoczny progres</title>
<style>
  body { background:#0f0f12; color:#e8e8ea; font-family:system-ui,sans-serif; margin:0; }
  header { padding:16px 20px; border-bottom:1px solid #222; }
  main { padding:16px 20px; display:grid; gap:12px; }
  .row { display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
  button { padding:10px 14px; font-size:15px; background:#1f1f26; color:#e8e8ea; border:1px solid #333; border-radius:8px; cursor:pointer; }
  button:hover { background:#262631; }
  #log { white-space:pre-wrap; max-height:180px; overflow:auto; background:#121218; border:1px solid #222; padding:10px; border-radius:8px; }
  #stats { font-family:monospace; }
  canvas { border:1px solid #222; border-radius:8px; max-width:100%; height:auto; }
</style>
</head>
<body>
<header>
  <h2>Generator z widocznym pojawianiem się pikseli</h2>
</header>

<main>
  <div class="row">
    <label>Rozmiar:</label>
    <input id="size" type="number" value="8000" min="2000" step="500">
    <label>Kafelek:</label>
    <input id="tile" type="number" value="32" min="8" step="4">
    <label>Cykle:</label>
    <input id="cycles" type="number" value="1000000" min="1000" step="1000">
  </div>

  <div class="row">
    <button id="start">Start</button>
    <button id="stop">Stop</button>
    <button id="save">Zapisz PNG</button>
  </div>

  <div id="stats">Wykonano: 0 | Pozostało: 0 | %: 0</div>
  <div id="log"></div>

  <canvas id="canvas"></canvas>
</main>

<script>
const logEl = document.getElementById("log");
const statsEl = document.getElementById("stats");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let running = false;

function log(t){
  logEl.textContent += t + "\\n";
  logEl.scrollTop = logEl.scrollHeight;
}

function updateStats(done, total){
  const left = Math.max(0, total - done);
  const pct = ((done/total)*100).toFixed(2);
  statsEl.textContent = `Wykonano: ${done} | Pozostało: ${left} | %: ${pct}`;
}

function randomTile(w,h){
  const img = ctx.createImageData(w,h);
  const d = img.data;
  for(let i=0;i<d.length;i+=4){
    d[i]   = Math.random()*256;
    d[i+1] = Math.random()*256;
    d[i+2] = Math.random()*256;
    d[i+3] = 255;
  }
  return img;
}

async function generate(size, tile, cycles){
  canvas.width = size;
  canvas.height = size;
  log("Start generowania. To potrwa, bo tak chciałeś.");
  let done = 0;

  for(let y=0; y<size && running; y+=tile){
    for(let x=0; x<size && running; x+=tile){
      const w = Math.min(tile, size-x);
      const h = Math.min(tile, size-y);

      const img = randomTile(w,h);
      ctx.putImageData(img, x, y);

      done++;
      if(done % 50 === 0){
        updateStats(done, cycles);
        await new Promise(r=>setTimeout(r,0)); // oddaj oddech przeglądarce
      }
      if(done >= cycles){
        updateStats(done, cycles);
        log("Osiągnięto limit cykli.");
        running = false;
        return;
      }
    }
  }
  updateStats(done, cycles);
  log("Koniec siatki.");
}

document.getElementById("start").onclick = ()=>{
  if(running) return;
  const size = parseInt(document.getElementById("size").value,10);
  const tile = parseInt(document.getElementById("tile").value,10);
  const cycles = parseInt(document.getElementById("cycles").value,10);
  running = true;
  updateStats(0, cycles);
  generate(size, tile, cycles);
};

document.getElementById("stop").onclick = ()=>{
  running = false;
  log("Zatrzymano ręcznie.");
};

document.getElementById("save").onclick = ()=>{
  const a = document.createElement("a");
  a.href = canvas.toDataURL("image/png");
  a.download = "mega.png";
  a.click();
};
</script>
</body>
  </html>
  
